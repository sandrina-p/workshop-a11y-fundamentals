<!DOCTYPE html>

<!--
üß© 3.3: Accessible forms
üéØ Goal: Build an accessible form

Notes:
- You don't need to change or remove CSS classes.
-->

<html lang="en">

<head>
  <title>Solution #3.3</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400,600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/theme.css">
</head>

<body>
  <main class="content">
    <h1 class="heading-1">Accessible Forms</h1>

    <form class="block_v form js-formItself">
      <h2 class="heading-2">Form: Web lover profile</h2>

      <!-- Lesson #1 - Input labels -->
      <div class="field">
        <label for="uName" class="field-txt">Nickname</label>
        <input type="text" id="uName">
      </div>

      <!-- Lesson #2 - Group checkbox/radio -->
      <fieldset class="field">
        <legend class="field-txt">Favorite theme</legend>
        <label class="inputRadio">
          <input type="radio" name="gender" value="dark">
          <span>Dark</span>
        </label>
        <label class="inputRadio">
          <input type="radio" name="gender" value="light">
          <span>Light</span>
        </label>
        <label class="inputRadio">
          <input type="radio" name="gender" value="whatever">
          <span>It depends</span>
        </label>
      </fieldset>

      <!-- Lesson #3 - Required inputs -->
      <label class="field js-fieldMandatory">
        <span class="field-txt">Year of your first computer <span class="u-danger">*</span></span>
        <!-- Lesson #3.1 - Input types -->
        <input type="text" aria-required="true" aria-describedby="jsYearError" inputmode="numeric" pattern="[0-9]*"
          class="js-fieldYear">
        <span class="field-error" id="jsYearError"></span> <!-- innerText added by JS -->
      </label>

      <!-- Lesson #4.1 - Input descriptions p1 -->
      <div class="field">
        <label for="uPass" class="field-txt">Worst password ever</label>
        <input type="password" id="uPass" class="js-secretInput" aria-describedby="passTip">
        <button class="js-secretBtn" aria-pressed="false" aria-label="Show password" type="button">üëÄ</button>

        <span class="field-tip" id="passTip">The password usually is dumb and short.</span>
      </div>

      <!-- üçÄ Lesson #4.2 - Inputs descriptions p1 -->
      <label class="field">
        <span class="u-block">
          To be here, you should care about web accessibility.
        </span>
        <input type="checkbox" /> Tick here if you agree with this.
      </label>


      <!-- üçÄ BONUS #1 - Live Regions -->
      <div class="form-footer">
        <p class="formMsg js-formFeedback" aria-live="polite"></p>
        <button class="btn btnPrimary js-btnSubmit">Submit</button>
      </div>
    </form>
  </main>

  <script>
    // The JS part is already done for you.

    // -----
    // Toggle password visibility
    const elSecretBtn = document.getElementsByClassName('js-secretBtn')[0]
    const elSecretInput = document.getElementsByClassName('js-secretInput')[0]

    elSecretBtn.addEventListener('click', function () {
      console.log('Toggle password clicked')
      const isPressed = elSecretBtn.getAttribute("aria-pressed") === 'true';
      // 1.toggle the button status visually and semantically
      elSecretBtn.textContent = isPressed ? 'üëÄ' : 'üôà'
      elSecretBtn.setAttribute("aria-pressed", !isPressed) // üçÄ #4.2.
      // 2. toggle input type
      elSecretInput.setAttribute("type", isPressed ? 'password' : 'text');
    })

    // -----
    // Listen for "submit" button click
    const elBtnSubmit = document.getElementsByClassName('js-btnSubmit')[0]
    document.getElementsByClassName('js-btnSubmit')[0].addEventListener('click', function () {
      console.log('Submit clicked')
    })

    // -----
    // Listen for form submission
    const elFormItself = document.getElementsByClassName('js-formItself')[0]
    const elFormFeedback = document.getElementsByClassName('js-formFeedback')[0]
    const elFieldYear = document.getElementsByClassName('js-fieldYear')[0]

    elFormItself.addEventListener('submit', (e) => {
      e.preventDefault()
      console.log('Form submitting...')

      updateFormMsg() // clear the form msg

      // Check if input tabs has a valid value
      if (!Number(elFieldYear.value)) {
        updateInlineError(elFieldYear, true, '‚ö†Ô∏è This year is required.')
        updateFormMsg('invalid')
        return
      }
      updateFormMsg('success')
    })

    function updateFormMsg(status) {
      switch (status) {
        case 'invalid':
          elFormFeedback.classList.add('u-danger')
          elFormFeedback.classList.remove('u-success')
          elFormFeedback.innerHTML = 'Ups! There are invalid fields, please review them.'
          break;
        case 'success':
          elFormFeedback.classList.remove('u-danger')
          elFormFeedback.classList.add('u-success')
          elFormFeedback.innerHTML = 'All good, thank you!'
          break;
        default:
          elFormFeedback.classList.remove('u-invalid', 'u-success')
          elFormFeedback.innerHTML = ''
          break;
      }
    }

    function updateInlineError(field, hasError, errorMsg) {
      elFieldYear.nextElementSibling.innerText = errorMsg || '';
      elFieldYear.nextElementSibling.style.display = hasError ? 'block' : 'none';

      // üçÄ Update aria-invalid attribute
      field.setAttribute('aria-invalid', hasError)

      if (hasError) {
        // Listen for future field changes ...
        field.removeEventListener('keyup', handleChange)
        field.addEventListener('keyup', handleChange)

        field.removeEventListener('change', handleChange)
        field.addEventListener('change', handleChange)

        // ... and remove error if it's valid again!
        function handleChange(e) {
          if (!!elFieldYear.value) {
            updateInlineError(e.target, false)
            field.removeEventListener('change', handleChange)
            field.removeEventListener('keyup', handleChange)
          }
        }
      }
    }
  </script>
</body>

</html>